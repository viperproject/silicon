import "coffee1.vpr"

method CoffeemakerRemoveGrinder(this: Ref) returns (grinder: Ref)
    //requires CoffeeMaker(this)
    //ensures CoffeeMaker(this)
    //ensures Grinder(grinder)
    //ensures unfolding CoffeeMaker(this) in !getHasBeans(this.CMGrinder)
    //ensures getHasBeans(grinder) == old(unfolding CoffeeMaker(this) in getHasBeans(this.CMGrinder))
{
    //unfold CoffeeMaker(this)
    grinder := this.CMGrinder
    this.CMGrinder := GrinderConstructor()
    //fold CoffeeMaker(this)
}

method RemoveGrinderHarness()
{
    var cm: Ref := CoffeeMakerConstructor()
    var grinder: Ref := CoffeemakerRemoveGrinder(cm)
    CoffeeMakerRestock(cm)
    GrinderAddBeans(grinder)
}