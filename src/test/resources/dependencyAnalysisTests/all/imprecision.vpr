field f: Int

// test fails
method permTest(a: Ref, b: Ref, n: Int)
    requires @dependency()(acc(a.f))
    requires @irrelevant()(acc(b.f)) && @irrelevant()(b.f > 0)
{
    @dependency()
    assume n > 0
    @irrelevant()
    a.f := b.f + 2
    @dependency()
    a.f := n
    @testAssertion()
    assert a.f >= 0
}


method quantifiedPerm2(xs: Seq[Ref], ys: Seq[Ref])
  requires @dependency()(|xs| > 5)
  requires @irrelevant()(|ys| > 3)
{
  @dependency()
  inhale (forall x: Ref :: x in xs ==> (acc(x.f, wildcard) && x.f > 0))
  @irrelevant()
  inhale forall y: Ref :: y in ys ==> (acc(y.f, wildcard) && y.f > 0)

  @testAssertion()
  assert xs[0].f > 0
}

method quantifiedPerm3(xs: Seq[Ref], ys: Seq[Ref])
  requires @dependency()(|xs| > 5)
  requires @irrelevant()(|ys| > 3)
{
  @dependency()
  inhale (forall x: Ref :: x in xs ==> (acc(x.f, wildcard) && x.f > 0))
  @irrelevant()
  inhale forall y: Ref :: y in ys ==> (acc(y.f, wildcard))

  @testAssertion()
  assert xs[0].f > 0
}

method quantifiedPerm4(xs: Seq[Ref], ys: Seq[Ref])
  requires @dependency()(|xs| > 5)
  requires @irrelevant()(|ys| > 3)
{
  @dependency()
  inhale (forall x: Ref :: x in xs ==> acc(x.f) && x.f > 0)
  @irrelevant()
  inhale forall y: Ref :: y in ys ==> acc(y.f)

  @testAssertion()
  assert xs[0].f > 0
}
